name: Test Report

on:
  workflow_run:
    workflows: ["Test"]
    types:
      - completed

jobs:
  report:
    runs-on: ubuntu-latest

    steps:

     # üîç Sanity-check: list everything the action just downloaded
      - name: Show downloaded artifact contents
        run: ls -R
        
      - name: Download .NET 9.0 Test Results
        uses: dawidd6/action-download-artifact@v2
        with:
          workflow: Test
          run_id: ${{ github.event.workflow_run.id }}
          name: test-results-net9.0
          path: ./TestResults/net9.0

      - name: Download .NET 8.0 Test Results
        uses: dawidd6/action-download-artifact@v2
        with:
          workflow: Test
          run_id: ${{ github.event.workflow_run.id }}
          name: test-results-net8.0
          path: ./TestResults/net8.0

      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: List Downloaded Files
        run: |
          echo "üìÇ Listing all downloaded artifact files..."
          ls -R ./TestResults || echo "‚ö†Ô∏è No TestResults directory found"

      - name: Generate Combined Test Report
        uses: dorny/test-reporter@v1
        with:
          artifact: |
            test-results-net9.0
            test-results-net8.0
          name: Unit Tests (.NET 8 & 9)
          path: '**/*.trx'
          reporter: dotnet-trx
          fail-on-error: false
          fail-on-empty: false
          list-suites: all
          list-tests: all
          max-annotations: 10
