name: Test Report

on:
  workflow_call:
    inputs:
      test_run_id:
        description: "Run ID of the completed Test workflow"
        required: false
        type: string
      branch:
        description: "Branch Test was run on"
        required: false
        type: string       
        
permissions:
  contents: read
  actions: read      
  checks: write

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code @ tested SHA
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.branch }}
          fetch-depth: 0

      - name: ⬇️  Download ALL artifacts from Test run
        if: ${{ inputs.test_run_id != '' }}        # manual runs only
        uses: actions/download-artifact@v4
        with:
            repository:   ${{ github.repository }} 
            run-id:       ${{ inputs.test_run_id }}
            path:         .
            github-token: ${{ secrets.GITHUB_TOKEN || github.token }}
      
      - uses: dorny/test-reporter@v1
        with:
          artifact: /test-results-net[89]\.0/
          name: "Unit Tests (.NET 8 & 9)"
          path: '**/*.trx'
          reporter: dotnet-trx
          fail-on-error: false
          fail-on-empty: false
          list-suites: all
          list-tests: all
          max-annotations: 10
